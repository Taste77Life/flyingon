<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--以IE的当前版本渲染,如果安装了ChromeFrame则优先使用-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title></title>
    <style type="text/css">
        html, body {
            margin: 0;
            height: 100%;
        }
    </style>
</head>
<body style="margin: 0;">

    <div style="width: 100%; height: 100%;">
        <div id="drag" style="background-color: yellow;">
            <input type="button" id="btnCreate" value="Create" onclick="create()" />
            <input type="button" id="btnPaint" value="Paint" onclick="paint()" />
            <input type="button" id="btnChangeBoxModel" value="changeBoxModel" onclick="changeBoxModel()" />
            <input type="button" id="btnResize" value="resize" onclick="resize()" />
            <input type="button" id="btnResize0" value="row" onclick="layout('row')" />
            <input type="button" id="btnResize1" value="column" onclick="layout('column')" />
            <input type="button" id="btnResize2" value="rows" onclick="layout('rows')" />
            <input type="button" id="btnResize3" value="columns" onclick="layout('columns')" />
            <input type="button" id="btnResize4" value="dock" onclick="layout('dock')" />
            <input type="button" id="btnResize5" value="page" onclick="layout('page')" />
            <input type="button" id="Button1" value="grid" onclick="layout('grid')" />
            <input type="button" id="Button2" value="table" onclick="layout('table')" />
            <input type="button" id="Button3" value="absolute" onclick="layout('absolute')" />
        </div>

        <div id="host" style="width: 100%; height: 100%;">
        </div>
    </div>


    <script type="text/javascript" src="../js/flyingon.js"></script>


    <script type="text/javascript">

        var update;

        var date = new Date();

        for (var i = 0; i < 1000000; i++)
        {
            //new flyingon.TextBox();

            //new flyingon.ListBoxItem();
        }

        alert(new Date() - date);


        var w = new flyingon.Window(host);

        w.layout = "rows";


        function create() {


            var date = new Date();

            flyingon.beginInit();
            w.layout = "rows";


            for (var k = 0; k < 20; k++)
            {
                var panel = new flyingon.Panel();

                for (var i = 0; i < 500; i++)
                {

                    var ctrl = new flyingon.Button();

                    ctrl.left = i % 20 * 100;
                    ctrl.top = i / 20 * 30;

                    ctrl.width = 20;
                    ctrl.height = 20;
                    ctrl["border"] = [1, 1, 1, 1];
                    ctrl["borderColor"] = new flyingon.LinearGradient(0, 0, 1, 1, [[0, "yellow"], [1, "red"]]);
                    ctrl.background = new flyingon.LinearGradient(0, 0, 1, 1, [[0, "red"], [0.5, "green"], [1, "blue"]]);
                    ctrl.stretch = "all";
                    ctrl.horizontalAlign = "center";
                    ctrl.verticalAlign = "center";

                    panel.children.append(ctrl);

                    switch (i % 5)
                    {
                        case 0:
                            ctrl.dock = "left";
                            break;

                        case 1:
                            ctrl.dock = "top";
                            break;

                        case 2:
                            ctrl.dock = "right";
                            break;

                        case 3:
                            ctrl.dock = "bottom";
                            break;

                        case 4:
                            ctrl.dock = "fill";
                            break;
                    }

                }


                //panel.autoSize = "all";
                panel.width = 600;
                panel.height = 400;
                panel["border"] = [10, 10, 10, 10];
                panel.borderColor = "orange";
                //panel.background = new flyingon.LinearGradient(0, 0, 1, 1, [[0, "red"], [0.5, "green"], [1, "blue"]]);
                panel.layout = "row";
                panel.layoutSpaceX = 5;
                panel.layoutSpaceY = 5;
                panel.layoutRowHeight = 50;
                panel.layoutColumnWidth = 60;
                panel.layoutRows = 10;
                panel.layoutColumns = 10;
                panel.layoutTable = "T R* C* C* R* C* C* T R* C* C* C* R* C* C* C* R* C* C* C* END C* R* C* C* END";
                //panel.scrollLeft = 100;


                w.children.append(panel);

                var win = panel.ownerWindow;

            }



            flyingon.endInit();
            alert(new Date() - date);

            w.update();

        };

        function paint() {

            var date = new Date();

            w.update();

            alert(new Date() - date);
        };

        function changeBoxModel() {

            var date = new Date();

            w.children.item(0)["border"] = [20, 20, 20, 20];
            w.update();

            alert(new Date() - date);
        };

        function resize() {

            var date = new Date();

            var button = w.children.item(0).children.item(1);
            button.height = 200;

            w.update();

            alert(new Date() - date);
        };


        function layout(value) {

            var date = new Date();

            for (var i = 0; i < w.children.length; i++)
            {
                var panel = w.children.item(i);
                panel.layout = value;
            }

            w.update();

            alert(new Date() - date);
        };


        function anonymous(value) {

            var storage = this['x:storage'], cache, name = 'layout';
            if (flyingon['x:initializing'])
            {
                storage[name] = value;
                (cache = this['x:bindings']) && this['y:bindings'](name, cache);
                return this;
            }

            var oldValue = storage[name];
            if (oldValue !== value)
            {
                if ((cache = this['x:events']) && (cache = cache['change']) && cache.length > 0)
                {
                    var event = new flyingon.ChangeEvent(this, name, value, oldValue);
                    if (!this.dispatchEvent(event)) return this;
                    value = event.value;
                }

                storage[name] = value;
                var boxModel = this['x:boxModel'];
                boxModel.scrollLeft = 0;
                boxModel.scrollTop = 0;
                (cache = this['x:bindings']) && this['y:bindings'](name, cache);
                if (cache = boxModel.parent)
                {
                    cache['x:measure'] = true;
                    cache.ownerControl.invalidate();
                }
                else
                {
                    boxModel['x:measure'] = true;
                    this.invalidate();
                }
            }
            return this;
        }

    </script>

</body>
</html>
